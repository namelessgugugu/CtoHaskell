## CtoHaskell

从 C 语言到 Haskell 语言的转换器，基于大语言模型。

## 暂定框架

`assistant.py`：提供与 LLM 对话的接口。

```python
class Assistant:
    def __init__(self, api_key, model, temperature, retry_limit):
        """
        Create a llm assistant with given model and temperature.

        Parameters:
            api_key - Api key of SiliconFlow.
            model - name of the model to be called.
            temperature - temperature set by the model.
            retry_limit - maximum number of retries if network error occurs.
        """
        pass
    
    def chat(self, messages):
        """
        Generate a response of given context.

        Parameters:
            messages - a list of previous conversation. Each message
                should follow the format { "role": "user" / "assistant",
                "content": <content>}.
        
        Returns:
            Response generated by llm.

        Raises:
            ApiError(code) - response has an unsuccessful status code, after
                retry_limit retries.
        """
        pass
```

`checker.py`：接入 GCC 与 GHC，做语法检查。

```python
class CChecker:
    def __init__(self, gcc_path):
        """
        Create a C syntax checker.

        Parameters:
            gcc_path - path of gcc.
        """
        pass

    def check(self, code):
        """
        Check whether code is grammatically correct.

        Parameters:
            code - C code.
        
        Returns:
            If code passes the check, None is returned,
            otherwise a string of error message is returned.
        """

class HaskellChecker:
    def __init__(self, ghc_path):
        """
        Create a Haskell syntax checker.

        Parameters:
            ghc_path - path of ghc.
        """
        pass

    def check(self, code):
        """
        Check whether code is grammatically correct.

        Parameters:
            code - Haskell code.
        
        Returns:
            If code passes the check, None is returned,
            otherwise a string of error message is returned.
        """
        pass
```

`preprocessor.py`：预处理 C 代码，提取全局变量。

```python
class Preprocessor:
    def __init__(self, gcc_path, fake_libc_path):
        """
        Create preprocessor of C code.

        Parameters:
            gcc_path - path of gcc.
            fake_libc_path - path of fake_libc_include, used by pycparser.
        """
        pass

    def preprocess(self, code):
        """
        Preprocess C code to split global varibles and other function.

        Parameters:
            code - C code to be preprocessed.

        Returns:
            global_varibles - code of all global varible declarations in code.
            other - other part of the code.
        """
        pass
```

`translator.py`：将 C 代码翻译到 Haskell 代码。

```python
class Translator:
    def __init__(self, assistant, retry_limit):
        """
        Create a translator with given assistant.

        Parameters:
            assistant - an Assistant from assistant.py.
            retry_limit - maximum number of retries if llm generates
                grammatically wrong code.
        """
        pass
    
    def translate(self, code):
        """
        Translate C code to Haskell.

        Parameters:
            code - C code to be translated.
        
        Returns:
            Haskell code.
        
        Raises:
            TranslateError - llm generates grammatically wrong code,
                after retry_limit retries.
        """
        pass
```

`optimizer.py`：对 Haskell 代码进行优化。

```python
class Optimizer:
    def __init__(self, assistant, retry_limit):
        """
        Create a Optimizer with given assistant.

        Parameters:
            assistant - an Assistant from assistant.py.
            retry_limit - maximum number of retries if llm generates
                grammatically wrong code.
        """
        pass
    
    def optimize(self, code):
        """
        Optimize Haskell code.

        Parameters:
            code - Haskell code to be optimized.
        
        Returns:
            Optimized code.
        
        Raises:
            OptimizeError - llm generates grammatically wrong code,
                after retry_limit retries.
        """
        pass
```

`verifier.py`：对 C 代码和 Haskell 代码进行对比。

```python
class Verifier:
    def __init__(self, assistant, retry_limit):
        """
        Create a Verifiers with given assistant.

        Parameters:
            assistant - an Assistant from assistant.py.
            retry_limit - maximum number of retries if llm generates
                grammatically wrong code.
        """
        pass
    
    def verify(self, c_code, haskell_code):
        """
        Verify whether c_code and haskell_code are the same.

        Parameters:
            c_code - C code.
            haskell_code - Haskell code.
        
        Returns:
            Modified haskell code, which equals to original haskell_code
            if it's correct.
        
        Raises:
            VerifyError - llm generates grammatically wrong code,
                after retry_limit retries.
        """
        pass
```

`ui.py`：用户界面。

暂不知道怎么写。